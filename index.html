<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calculadora de Renegocia√ß√£o de D√≠vidas - Sistema inteligente para an√°lise de cen√°rios com d√©bito em conta">
    <meta name="author" content="Cabanellos">
    <title>Calculadora de Renegocia√ß√£o | Cabanellos</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∞</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #C4A35A 0%, #8B7355 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .header {
            background: linear-gradient(135deg, #C4A35A 0%, #8B7355 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 20px 20px 0 0;
        }
        .header h1 { 
            font-size: 28px; 
            margin-bottom: 10px;
            letter-spacing: 2px;
            font-weight: 300;
        }
        .header p {
            font-size: 14px;
            opacity: 0.9;
            letter-spacing: 1px;
        }
        .input-section { padding: 30px; background: #f8f9fa; }
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .input-group-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-field { display: flex; flex-direction: column; }
        .form-field label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2C3E50;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .form-field select, .form-field input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .form-field select:focus, .form-field input:focus {
            outline: none;
            border-color: #C4A35A;
        }
        .info-box {
            background: #fff9e6;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #C4A35A;
        }
        .info-box-title {
            font-weight: 600;
            color: #8B7355;
            margin-bottom: 8px;
            font-size: 13px;
        }
        .info-box-text {
            font-size: 12px;
            color: #6B5B47;
            line-height: 1.5;
        }
        .contracts-section { padding: 30px; }
        .contracts-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2C3E50;
            letter-spacing: 0.5px;
        }
        .contract-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr 100px;
            gap: 15px;
            align-items: center;
        }
        .contract-item input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .btn-add {
            background: #C4A35A;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 10px;
            transition: background 0.3s;
        }
        .btn-add:hover {
            background: #B39350;
        }
        .btn-calculate {
            background: linear-gradient(135deg, #C4A35A 0%, #8B7355 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            margin: 30px;
            width: calc(100% - 60px);
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: transform 0.2s;
        }
        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(196, 163, 90, 0.3);
        }
        .results-section { padding: 30px; background: #f8f9fa; }
        .info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .info-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 3px solid #C4A35A;
        }
        .info-card-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }
        .info-card-value {
            font-size: 28px;
            font-weight: 700;
            color: #C4A35A;
        }
        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .scenario-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            transition: transform 0.2s;
        }
        .scenario-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .scenario-card.best {
            border: 2px solid #C4A35A;
            background: linear-gradient(135deg, #ffffff 0%, #fff9e6 100%);
        }
        .scenario-badge {
            display: inline-block;
            background: #C4A35A;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .range-badge {
            display: inline-block;
            background: #8B7355;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 10px;
        }
        .scenario-title {
            font-size: 18px;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 15px;
        }
        .scenario-detail {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }
        .scenario-pmt {
            background: linear-gradient(135deg, #C4A35A 0%, #8B7355 100%);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }
        .scenario-pmt-label { font-size: 12px; opacity: 0.9; }
        .scenario-pmt-value {
            font-size: 24px;
            font-weight: 700;
            margin-top: 4px;
        }
        .extra-payment-section {
            background: #fff9e6;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #C4A35A;
        }
        .extra-payment-title {
            font-weight: 600;
            color: #8B7355;
            margin-bottom: 10px;
            font-size: 13px;
        }
        .extra-payment-detail {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 13px;
            color: #6B5B47;
        }
        .debito-section {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #3b82f6;
        }
        .debito-title {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 10px;
            font-size: 13px;
        }
        .debito-detail {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 13px;
            color: #1e3a8a;
        }
        .calc-desconto-section {
            background: #fef3c7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #f59e0b;
        }
        .calc-desconto-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 10px;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .calc-desconto-input {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            align-items: center;
        }
        .calc-desconto-input input {
            flex: 1;
            padding: 8px;
            border: 1px solid #d97706;
            border-radius: 4px;
            font-size: 13px;
        }
        .calc-desconto-input button {
            background: #d97706;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }
        .calc-desconto-result {
            background: white;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }
        .btn-remove {
            background: #dc2626;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn-remove:hover {
            background: #b91c1c;
        }
        .alert {
            background: #e8f4f8;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .input-group {
                grid-template-columns: 1fr;
            }
            .contract-item {
                grid-template-columns: 1fr;
            }
            .scenarios-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CABANELLOS</h1>
            <p>Calculadora de Renegocia√ß√£o de D√≠vidas</p>
        </div>

        <div class="input-section">
            <div class="input-group">
                <div class="form-field">
                    <label>Status da Liminar</label>
                    <select id="liminar">
                        <option value="deferido">DEFERIDO (Com Liminar)</option>
                        <option value="indeferido">INDEFERIDO (Sem Liminar)</option>
                    </select>
                </div>
                <div class="form-field">
                    <label>Margem Consign√°vel (R$)</label>
                    <input type="text" id="margem" placeholder="Ex: 1.462,16">
                </div>
                <div class="form-field">
                    <label>Parcelas do Refor√ßo (meses)</label>
                    <input type="number" id="parcelas-reforco" value="12" min="1" max="24">
                </div>
            </div>
            <div class="input-group-2">
                <div class="info-box">
                    <div class="info-box-title">üìã Entenda as modalidades:</div>
                    <div class="info-box-text">
                        <strong>Refor√ßo:</strong> Parcela extra opcional para pagar o desconto concedido (voc√™ define as parcelas)<br>
                        <strong>D√©bito em Conta:</strong> O sistema calcula automaticamente a melhor quantidade de parcelas para facilitar o que n√£o cabe na margem
                    </div>
                </div>
            </div>
        </div>

        <div class="contracts-section">
            <div class="contracts-title">üìã Contratos</div>
            <div id="contracts-container">
                <div class="contract-item">
                    <input type="text" placeholder="Saldo (R$)" class="contract-saldo">
                    <input type="text" placeholder="PMT Atual (R$)" class="contract-pmt">
                    <button class="btn-remove" onclick="removeContract(this)">Remover</button>
                </div>
            </div>
            <button class="btn-add" onclick="addContract()">+ Adicionar Contrato</button>
        </div>

        <button class="btn-calculate" onclick="calcular()">üîç CALCULAR CEN√ÅRIOS</button>

        <div class="results-section" id="results" style="display: none;">
            <h2 style="text-align: center; margin-bottom: 20px; color: #2C3E50;">üìä Resultados da An√°lise</h2>
            
            <div class="info-cards">
                <div class="info-card">
                    <div class="info-card-label">Saldo Cont√°bil</div>
                    <div class="info-card-value" id="info-saldo-contabil">R$ 0,00</div>
                </div>
                <div class="info-card">
                    <div class="info-card-label">Margem Dispon√≠vel</div>
                    <div class="info-card-value" id="info-margem">R$ 0,00</div>
                </div>
                <div class="info-card">
                    <div class="info-card-label">PMT Atual Total</div>
                    <div class="info-card-value" id="info-pmt-atual">R$ 0,00</div>
                </div>
            </div>

            <div id="alert-container"></div>
            <div class="scenarios-grid" id="scenarios-grid"></div>
        </div>
    </div>

    <script>
        function addContract() {
            const container = document.getElementById('contracts-container');
            const div = document.createElement('div');
            div.className = 'contract-item';
            div.innerHTML = `
                <input type="text" placeholder="Saldo (R$)" class="contract-saldo">
                <input type="text" placeholder="PMT Atual (R$)" class="contract-pmt">
                <button class="btn-remove" onclick="removeContract(this)">Remover</button>
            `;
            container.appendChild(div);
            addInputListeners();
        }

        function removeContract(btn) {
            const container = document.getElementById('contracts-container');
            if (container.children.length > 1) {
                btn.parentElement.remove();
            }
        }

        function parseBR(val) {
            if (!val) return 0;
            const cleaned = val.toString().replace(/[^\d,.-]/g, '').replace(/\./g, '').replace(',', '.');
            return parseFloat(cleaned) || 0;
        }

        function formatBR(val) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2
            }).format(val);
        }

        function formatInput(input) {
            const valor = parseBR(input.value);
            if (valor > 0) {
                input.value = valor.toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            }
        }

        function addInputListeners() {
            document.querySelectorAll('input[type="text"]').forEach(input => {
                input.removeEventListener('paste', handlePaste);
                input.removeEventListener('blur', handleBlur);
                input.addEventListener('paste', handlePaste);
                input.addEventListener('blur', handleBlur);
            });
        }

        function handlePaste(e) { setTimeout(() => formatInput(e.target), 10); }
        function handleBlur(e) {
            if (e.target.classList.contains('contract-saldo') || 
                e.target.classList.contains('contract-pmt') || 
                e.target.id === 'margem') {
                formatInput(e.target);
            }
        }

        function calcPMT(saldo, taxa, prazo) {
            if (taxa === 0) return saldo / prazo;
            return (taxa * saldo) / (1 - Math.pow(1 + taxa, -prazo));
        }

        function getMaxDesc(prazo, liminar) {
            if (prazo <= 84) return liminar ? 0.35 : 0.20;
            if (prazo <= 96) return liminar ? 0.25 : 0.20;
            if (prazo <= 149) return 0.15;
            return 0.10;
        }

        function getRangeName(prazo) {
            if (prazo <= 84) return 'At√© 84 meses';
            if (prazo <= 96) return '85-96 meses';
            if (prazo <= 149) return '97-149 meses';
            return '150 meses';
        }

        function calcularDesconto(cardId, valorDesc, prazo) {
            const resultDiv = document.getElementById(`result-${cardId}`);
            const inputParcelas = document.getElementById(`input-parcelas-${cardId}`);
            const parcelas = parseInt(inputParcelas.value) || prazo;
            
            const parcelaDesc = valorDesc / parcelas;
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="debito-detail" style="font-weight: 600; margin-bottom: 5px;">
                    <span>üí∞ Parcelamento do Desconto</span>
                </div>
                <div class="debito-detail">
                    <span>Valor Total Descontado:</span>
                    <strong>${formatBR(valorDesc)}</strong>
                </div>
                <div class="debito-detail">
                    <span>Parcelar em ${parcelas}x:</span>
                    <strong>${formatBR(parcelaDesc)}</strong>
                </div>
                <div style="background: #fed7aa; padding: 8px; border-radius: 4px; margin-top: 8px; font-size: 11px; color: #92400e; text-align: center;">
                    ‚úì D√©bito em conta: ${formatBR(parcelaDesc)}/m√™s durante ${parcelas} meses
                </div>
            `;
        }

        function calcular() {
            try {
                const liminar = document.getElementById('liminar').value === 'deferido';
                const margem = parseBR(document.getElementById('margem').value);
                const parcelasReforco = parseInt(document.getElementById('parcelas-reforco').value) || 12;
                
                if (margem === 0) {
                    alert('Por favor, informe a margem consign√°vel!');
                    return;
                }

                const items = document.querySelectorAll('.contract-item');
                const contratos = [];
                let pmtAtual = 0, saldoTotal = 0;

                items.forEach(item => {
                    const saldo = parseBR(item.querySelector('.contract-saldo').value);
                    const pmt = parseBR(item.querySelector('.contract-pmt').value);
                    if (saldo > 0) {
                        contratos.push({saldo, pmt: pmt || 0});
                        saldoTotal += saldo;
                        pmtAtual += pmt;
                    }
                });

                if (contratos.length === 0) {
                    alert('Adicione pelo menos um contrato com saldo v√°lido!');
                    return;
                }

                document.getElementById('info-saldo-contabil').textContent = formatBR(saldoTotal);
                document.getElementById('info-margem').textContent = formatBR(margem);
                document.getElementById('info-pmt-atual').textContent = formatBR(pmtAtual);

                const prazosEstrategicos = [150, 140, 130, 120, 110, 100, 96, 90, 84, 78, 72, 66, 60, 54, 48, 42];
                const taxa = 0.012;
                const cenariosFinais = [];

                prazosEstrategicos.forEach(prazo => {
                    const maxDesc = getMaxDesc(prazo, liminar);
                    
                    for (let desc = 0; desc <= maxDesc; desc += 0.005) {
                        let pmtTotal = 0, saldoOrig = 0, saldoDesc = 0;

                        contratos.forEach(c => {
                            const saldoComDesc = c.saldo * (1 - desc);
                            const pmtContrato = calcPMT(saldoComDesc, taxa, prazo);
                            pmtTotal += pmtContrato;
                            saldoOrig += c.saldo;
                            saldoDesc += saldoComDesc;
                        });

                        const montante = pmtTotal * prazo;
                        const valorDesc = saldoOrig - saldoDesc;
                        const parcelaReforcoCalc = valorDesc / parcelasReforco;
                        
                        const cabeNaMargem = pmtTotal <= margem;
                        const margemSobrando = cabeNaMargem ? (margem - pmtTotal) : 0;
                        
                        let valorFaltanteMensal = 0;
                        let valorFaltanteTotal = 0;
                        let parcelaDebito = 0;
                        let parcelasDebito = prazo;
                        let valorTotalDebito = 0;
                        
                        if (!cabeNaMargem) {
                            valorFaltanteMensal = pmtTotal - margem;
                            valorFaltanteTotal = valorFaltanteMensal * prazo;
                            valorTotalDebito = valorDesc + valorFaltanteTotal;
                            parcelasDebito = prazo;
                            parcelaDebito = valorTotalDebito / parcelasDebito;
                        }
                        
                        const pmtComDebito = !cabeNaMargem ? (margem + parcelaDebito) : pmtTotal;

                        if (cabeNaMargem) {
                            cenariosFinais.push({
                                prazo, desc: desc * 100, saldoOrig, saldoDesc, valorDesc,
                                pmt: pmtTotal, montante, custo: montante - saldoDesc,
                                cabeNaMargem, margemSobrando, parcelaReforco: parcelaReforcoCalc,
                                parcelasReforco, valorFaltanteMensal: 0, valorFaltanteTotal: 0, 
                                parcelaDebito, parcelasDebito, valorTotalDebito: 0, 
                                pmtComDebito, range: getRangeName(prazo)
                            });
                            return;
                        }
                    }
                    
                    let pmtTotal = 0, saldoOrig = 0, saldoDesc = 0;
                    contratos.forEach(c => {
                        const saldoComDesc = c.saldo * (1 - maxDesc);
                        const pmtContrato = calcPMT(saldoComDesc, taxa, prazo);
                        pmtTotal += pmtContrato;
                        saldoOrig += c.saldo;
                        saldoDesc += saldoComDesc;
                    });

                    const montante = pmtTotal * prazo;
                    const valorDesc = saldoOrig - saldoDesc;
                    const valorFaltanteMensal = pmtTotal - margem;
                    const valorFaltanteTotal = valorFaltanteMensal * prazo;
                    const valorTotalDebito = valorDesc + valorFaltanteTotal;
                    const parcelasDebito = prazo;
                    const parcelaDebito = valorTotalDebito / parcelasDebito;

                    cenariosFinais.push({
                        prazo, desc: maxDesc * 100, saldoOrig, saldoDesc, valorDesc,
                        pmt: pmtTotal, montante, custo: montante - saldoDesc,
                        cabeNaMargem: false, margemSobrando: 0, parcelaReforco: 0,
                        parcelasReforco, valorFaltanteMensal, valorFaltanteTotal, 
                        parcelaDebito, parcelasDebito, valorTotalDebito, 
                        pmtComDebito: margem + parcelaDebito, range: getRangeName(prazo)
                    });
                });

                const totalViaveis = cenariosFinais.filter(c => c.cabeNaMargem).length;

                document.getElementById('results').style.display = 'block';
                const grid = document.getElementById('scenarios-grid');
                grid.innerHTML = '';

                document.getElementById('alert-container').innerHTML = `
                    <div class="alert">
                        <strong>üí° Cen√°rios Inteligentes Selecionados</strong><br>
                        Mostrando <strong>${cenariosFinais.length} cen√°rios estrat√©gicos</strong> com prazos variados (42 a 150 meses).<br>
                        <strong>${totalViaveis} cen√°rios cabem</strong> na margem de ${formatBR(margem)}.<br>
                        <strong>L√≥gica:</strong> Para cada prazo, mostra o MENOR DESCONTO que cabe na margem.<br>
                        <strong>D√©bito em Conta:</strong> Calculado automaticamente no MESMO PRAZO do contrato.
                    </div>
                `;

                cenariosFinais.forEach((c, i) => {
                    const card = document.createElement('div');
                    card.className = 'scenario-card';
                    
                    if (i === 0 && c.cabeNaMargem) {
                        card.classList.add('best');
                    }

                    const cardId = `card-${i}`;

                    card.innerHTML = `
                        ${i === 0 && c.cabeNaMargem ? '<span class="scenario-badge">‚ú® MELHOR OP√á√ÉO</span>' : ''}
                        <span class="range-badge">${c.range}</span>
                        <div class="scenario-title">Cen√°rio ${i + 1}</div>
                        <div class="scenario-detail">
                            <span>Saldo Cont√°bil</span>
                            <strong>${formatBR(c.saldoOrig)}</strong>
                        </div>
                        <div class="scenario-detail">
                            <span>Prazo</span>
                            <strong>${c.prazo} meses</strong>
                        </div>
                        <div class="scenario-detail">
                            <span>Desconto</span>
                            <strong>${c.desc.toFixed(2)}%</strong>
                        </div>
                        <div class="scenario-detail">
                            <span>Valor Desconto</span>
                            <strong>${formatBR(c.valorDesc)}</strong>
                        </div>
                        <div class="scenario-detail">
                            <span>Saldo a Negociar</span>
                            <strong>${formatBR(c.saldoDesc)}</strong>
                        </div>
                        <div class="scenario-detail">
                            <span>Montante Total</span>
                            <strong>${formatBR(c.montante)}</strong>
                        </div>
                        <div class="scenario-detail">
                            <span>Custo Total</span>
                            <strong>${formatBR(c.custo)}</strong>
                        </div>
                        <div class="scenario-pmt" style="${!c.cabeNaMargem ? 'background: #dc2626;' : ''}">
                            <div class="scenario-pmt-label">Parcela Mensal (PMT)</div>
                            <div class="scenario-pmt-value">${formatBR(c.pmt)}</div>
                            <div style="font-size: 11px; margin-top: 4px;">
                                ${c.cabeNaMargem ? '‚úì Sobram ' + formatBR(c.margemSobrando) + ' de margem' : '‚ö† Faltam ' + formatBR(c.valorFaltanteMensal) + '/m√™s'}
                            </div>
                        </div>
                        
                        ${c.cabeNaMargem && c.valorDesc > 0 ? `
                        <div class="extra-payment-section">
                            <div class="extra-payment-title">üí∞ OP√á√ÉO: Refor√ßo (Parcelamento do Desconto)</div>
                            <div class="extra-payment-detail">
                                <span>Valor a Parcelar:</span>
                                <strong>${formatBR(c.valorDesc)}</strong>
                            </div>
                            <div class="extra-payment-detail">
                                <span>Em ${c.parcelasReforco}x de:</span>
                                <strong>${formatBR(c.parcelaReforco)}</strong>
                            </div>
                        </div>
                        
                        <div class="calc-desconto-section">
                            <div class="calc-desconto-title">
                                üßÆ Facilitar Desconto em D√©bito
                            </div>
                            <div class="calc-desconto-input">
                                <input type="number" id="input-parcelas-${cardId}" value="${c.prazo}" min="1" max="150" placeholder="Parcelas">
                                <button onclick="calcularDesconto('${cardId}', ${c.valorDesc}, ${c.prazo})">Calcular</button>
                            </div>
                            <div id="result-${cardId}" class="calc-desconto-result"></div>
                        </div>
                        ` : ''}
                        
                        ${!c.cabeNaMargem ? `
                        <div class="debito-section">
                            <div class="debito-title">üí≥ SOLU√á√ÉO: D√©bito em Conta Corrente</div>
                            <div class="debito-detail">
                                <span>Valor do Desconto Concedido:</span>
                                <strong>${formatBR(c.valorDesc)}</strong>
                            </div>
                            <div style="background: #fef2f2; padding: 8px; border-radius: 4px; margin: 8px 0; border-left: 3px solid #ef4444;">
                                <div class="debito-detail" style="border: none; color: #991b1b;">
                                    <span>Falta por m√™s:</span>
                                    <strong>${formatBR(c.valorFaltanteMensal)}</strong>
                                </div>
                                <div class="debito-detail" style="border: none; color: #991b1b;">
                                    <span>√ó ${c.prazo} meses =</span>
                                    <strong>${formatBR(c.valorFaltanteTotal)}</strong>
                                </div>
                            </div>
                            <div style="background: #dbeafe; padding: 8px; border-radius: 4px; margin: 8px 0;">
                                <div class="debito-detail" style="font-weight: 600; border: none;">
                                    <span>= TOTAL EM D√âBITO:</span>
                                    <strong style="color: #1e40af; font-size: 16px;">${formatBR(c.valorTotalDebito)}</strong>
                                </div>
                            </div>
                            <div class="debito-detail">
                                <span>Parcelar em ${c.parcelasDebito}x:</span>
                                <strong>${formatBR(c.parcelaDebito)}</strong>
                            </div>
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #3b82f6;">
                                <div class="debito-detail" style="background: #1e40af; color: white; padding: 10px; margin: 0 -8px; border-radius: 4px;">
                                    <span>Margem + D√©bito Mensal =</span>
                                    <strong style="font-size: 18px;">${formatBR(c.pmtComDebito)}/m√™s</strong>
                                </div>
                            </div>
                            <div style="background: #fff9e6; padding: 10px; border-radius: 4px; margin-top: 10px; font-size: 11px; color: #8B7355;">
                                ‚ÑπÔ∏è <strong>D√©bito Total:</strong> ${formatBR(c.valorDesc)} (desconto) + ${formatBR(c.valorFaltanteTotal)} (faltante) = ${formatBR(c.valorTotalDebito)} em ${c.parcelasDebito}x
                            </div>
                        </div>
                        ` : ''}
                    `;
                    grid.appendChild(card);
                });

                document.getElementById('results').scrollIntoView({behavior: 'smooth'});

            } catch (err) {
                alert('Erro: ' + err.message);
                console.error(err);
            }
        }

        document.addEventListener('DOMContentLoaded', addInputListeners);
    </script>
</body>
</html>
